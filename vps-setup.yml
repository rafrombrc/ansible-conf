---
- hosts: vps
  vars_files:
    - config/vps.yml
    - config/vps-vault.yml
  handlers:
    - import_tasks: handlers.yml

  roles:
    - role: swapfile
      become: true
      tags: swapfile

    - role: set-hostname
      become: true
      tags: set-hostname

    - role: sudoers
      become: true
      tags: sudoers

    - role: rob-user
      become: true
      tags: rob-user

    - role: arch-base
      become: true
      tags: arch-base

    - role: nginx
      become: true
      vars:
        conf_file: vps.nginx.conf
      tags: nginx

    - role: anubis
      become: true
      tags: anubis

    - role: podman
      become: true
      tags: podman

    - role: piwigo
      become: true
      become_user: pods
      tags: piwigo

    - role: searxng
      become: true
      become_user: pods
      tags: searxng

    - role: immich
      become: true
      become_user: pods
      tags: immich

    - role: ente
      become: true
      become_user: pods
      tags: ente

    - role: loop-role
      vars:
        inner_role: hugo-sites
        inner_role_args: "{{ hugo_sites }}"
        repos_dir: /home/rob/src/www
      tags: hugo-sites
